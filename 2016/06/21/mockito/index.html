<!DOCTYPE html>





<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">
  <meta name="google-site-verification" content="bMH0URCoOdzdhSMyGeDuGebWiSxHnJsOLundsaPEZbc">
  <meta name="msvalidate.01" content="EC8F55291A196E9DD39DDDB134E93A69">
  <meta name="baidu-site-verification" content="QC6bRBu8qm">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: 'search.xml'
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="mock和Mockito的关系在软件开发中提及”mock”，通常理解为模拟对象。 为什么需要模拟? 在我们一开始学编程时,我们所写的对象通常都是独立的，并不依赖其他的类，也不会操作别的类。但实际上，软件中是充满依赖关系的，比如我们会基于service类写操作类,而service类又是基于数据访问类(DAO)的，依次下去，形成复杂的依赖关系。 单元测试的思路就是我们想在不涉及依赖关系的情况下测试代码">
<meta name="keywords" content="mock,Mockito,单元测试">
<meta property="og:type" content="article">
<meta property="og:title" content="Mockito使用指南 - 单元测试的正确姿势">
<meta property="og:url" content="http://blog.hanschen.site/2016/06/21/mockito/index.html">
<meta property="og:site_name" content="HansChen 的博客">
<meta property="og:description" content="mock和Mockito的关系在软件开发中提及”mock”，通常理解为模拟对象。 为什么需要模拟? 在我们一开始学编程时,我们所写的对象通常都是独立的，并不依赖其他的类，也不会操作别的类。但实际上，软件中是充满依赖关系的，比如我们会基于service类写操作类,而service类又是基于数据访问类(DAO)的，依次下去，形成复杂的依赖关系。 单元测试的思路就是我们想在不涉及依赖关系的情况下测试代码">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-09-02T06:30:29.821Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mockito使用指南 - 单元测试的正确姿势">
<meta name="twitter:description" content="mock和Mockito的关系在软件开发中提及”mock”，通常理解为模拟对象。 为什么需要模拟? 在我们一开始学编程时,我们所写的对象通常都是独立的，并不依赖其他的类，也不会操作别的类。但实际上，软件中是充满依赖关系的，比如我们会基于service类写操作类,而service类又是基于数据访问类(DAO)的，依次下去，形成复杂的依赖关系。 单元测试的思路就是我们想在不涉及依赖关系的情况下测试代码">
  <link rel="alternate" href="/atom.xml" title="HansChen 的博客" type="application/atom+xml">
  <link rel="canonical" href="http://blog.hanschen.site/2016/06/21/mockito/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Mockito使用指南 - 单元测试的正确姿势 | HansChen 的博客</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HansChen 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.hanschen.site/2016/06/21/mockito/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenhang">
      <meta itemprop="description" content="博观而约取，厚积而薄发。">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HansChen 的博客">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">Mockito使用指南 - 单元测试的正确姿势

              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-06-21 00:00:00" itemprop="dateCreated datePublished" datetime="2016-06-21T00:00:00+08:00">2016-06-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-09-02 14:30:29" itemprop="dateModified" datetime="2019-09-02T14:30:29+08:00">2019-09-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/测试/" itemprop="url" rel="index"><span itemprop="name">测试</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon"
              >
                <i class="fa fa-eye"></i>
                 阅读次数： 
                <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
              </span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">评论数：</span>
    
  
    <a href="/2016/06/21/mockito/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/06/21/mockito/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span title="本文字数">15k</span>
            </span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span title="阅读时长">13 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="mock和Mockito的关系"><a href="#mock和Mockito的关系" class="headerlink" title="mock和Mockito的关系"></a>mock和Mockito的关系</h1><p>在软件开发中提及”mock”，通常理解为模拟对象。</p>
<p>为什么需要模拟? 在我们一开始学编程时,我们所写的对象通常都是独立的，并不依赖其他的类，也不会操作别的类。但实际上，软件中是充满依赖关系的，比如我们会基于service类写操作类,而service类又是基于数据访问类(DAO)的，依次下去，形成复杂的依赖关系。</p>
<p>单元测试的思路就是我们想在不涉及依赖关系的情况下测试代码。这种测试可以让你无视代码的依赖关系去测试代码的有效性。核心思想就是如果代码按设计正常工作，并且依赖关系也正常，那么他们应该会同时工作正常。</p>
<p>有些时候，我们代码所需要的依赖可能尚未开发完成，甚至还不存在，那如何让我们的开发进行下去呢？使用mock可以让开发进行下去，<strong>mock技术的目的和作用就是模拟一些在应用中不容易构造或者比较复杂的对象，从而把测试与测试边界以外的对象隔离开</strong>。</p>
<a id="more"></a>

<p>我们可以自己编写自定义的Mock对象实现mock技术，但是编写自定义的Mock对象需要额外的编码工作，同时也可能引入错误。现在实现mock技术的优秀开源框架有很多，<strong>Mockito就是一个优秀的用于单元测试的mock框架</strong>。Mockito已经在github上开源，详细请点击：<a href="https://github.com/mockito/mockito" target="_blank" rel="noopener">https://github.com/mockito/mockito</a></p>
<p>除了Mockito以外，还有一些类似的框架，比如：</p>
<ul>
<li>EasyMock：早期比较流行的MocK测试框架。它提供对接口的模拟，能够通过录制、回放、检查三步来完成大体的测试过程，可以验证方法的调用种类、次数、顺序，可以令 Mock 对象返回指定的值或抛出指定异常</li>
<li>PowerMock：这个工具是在EasyMock和Mockito上扩展出来的，目的是为了解决EasyMock和Mockito不能解决的问题，比如对static, final, private方法均不能mock。其实测试架构设计良好的代码，一般并不需要这些功能，但如果是在已有项目上增加单元测试，老代码有问题且不能改时，就不得不使用这些功能了</li>
<li>JMockit：JMockit 是一个轻量级的mock框架是用以帮助开发人员编写测试程序的一组工具和API，该项目完全基于 Java 5 SE 的 java.lang.instrument 包开发，内部使用 ASM 库来修改Java的Bytecode</li>
</ul>
<p>Mockito已经被广泛应用，所以这里重点介绍Mockito。</p>
<h1 id="Mockito使用举例"><a href="#Mockito使用举例" class="headerlink" title="Mockito使用举例"></a>Mockito使用举例</h1><p>这里我们直接通过一个代码来说明mockito对单元测试的帮助，代码有三个类，分别如下：<br>Person类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>    id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonDAO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Person <span class="title">getPerson</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">update</span><span class="params">(Person person)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PersonService：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PersonDao personDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonService</span><span class="params">(PersonDao personDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.personDao = personDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        Person person = personDao.getPerson(id);</span><br><span class="line">        <span class="keyword">if</span> (person == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Person personUpdate = <span class="keyword">new</span> Person(person.getId(), name);</span><br><span class="line">        <span class="keyword">return</span> personDao.update(personUpdate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里，我们要<strong>进行测试的是PersonService类的update方法</strong>，我们发现，update方法依赖PersonDAO，在开发过程中，<strong>PersonDAO很可能尚未开发完成</strong>，所以我们测试PersonService的时候，所以该怎么测试update方法呢？连接口都还没实现，怎么知道返回的是true还是false？在这里，我们可以这样认为，单元测试的思路就是我们想在不涉及依赖关系的情况下测试代码。这种测试可以让你无视代码的依赖关系去测试代码的有效性。核心思想就是如果代码按设计正常工作，并且依赖关系也正常，那么他们应该会同时工作正常。所以我们的做法是mock一个PersonDAO对象，至于实际环境中，PersonDAO行为是否能按照预期执行，比如update是否能成功，查询是否返回正确的数据，就跟PersonService没关系了。PersonService的单元测试只测试自己的逻辑是否有问题</p>
<p>下面编写测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PersonDao     mockDao;</span><br><span class="line">    <span class="keyword">private</span> PersonService personService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//模拟PersonDao对象</span></span><br><span class="line">        mockDao = mock(PersonDao.class);</span><br><span class="line">        when(mockDao.getPerson(<span class="number">1</span>)).thenReturn(<span class="keyword">new</span> Person(<span class="number">1</span>, <span class="string">"Person1"</span>));</span><br><span class="line">        when(mockDao.update(isA(Person.class))).thenReturn(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        personService = <span class="keyword">new</span> PersonService(mockDao);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = personService.update(<span class="number">1</span>, <span class="string">"new name"</span>);</span><br><span class="line">        assertTrue(<span class="string">"must true"</span>, result);</span><br><span class="line">        <span class="comment">//验证是否执行过一次getPerson(1)</span></span><br><span class="line">        verify(mockDao, times(<span class="number">1</span>)).getPerson(eq(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//验证是否执行过一次update</span></span><br><span class="line">        verify(mockDao, times(<span class="number">1</span>)).update(isA(Person.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateNotFind</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = personService.update(<span class="number">2</span>, <span class="string">"new name"</span>);</span><br><span class="line">        assertFalse(<span class="string">"must true"</span>, result);</span><br><span class="line">        <span class="comment">//验证是否执行过一次getPerson(1)</span></span><br><span class="line">        verify(mockDao, times(<span class="number">1</span>)).getPerson(eq(<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//验证是否执行过一次update</span></span><br><span class="line">        verify(mockDao, never()).update(isA(Person.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们对PersonDAO进行mock，并且设置stubbing，stubbing设置如下：</p>
<ul>
<li>当getPerson方法传入1的时候，返回一个Person对象，否则默认返回空</li>
<li>当调update方法的时候，返回true</li>
</ul>
<p>我们验证了两种情况：</p>
<ul>
<li>更新id为1的Person的名字，预期：能在DAO中找到Person并更新成功</li>
<li>更新id为2的Person的名字，预期：不能在DAO中找到Person，更新失败</li>
</ul>
<p>这样，根据PersonService的update方法的逻辑，通过这两个test case之后，我们认为代码是没有问题的。mockito在这里扮演了一个为我们模拟DAO对象，并且帮助我们验证行为（比如验证是否调用了getPerson方法及update方法）的角色</p>
<h1 id="Android-Studio工程配置Mockito"><a href="#Android-Studio工程配置Mockito" class="headerlink" title="Android Studio工程配置Mockito"></a>Android Studio工程配置Mockito</h1><p>Android Studio中使用Mockito非常简单，只需要在build.gradle文件中加入依赖即可。如图：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    testCompile <span class="string">'org.mockito:mockito-core:1.10.19'</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Mockito使用方法"><a href="#Mockito使用方法" class="headerlink" title="Mockito使用方法"></a>Mockito使用方法</h1><p>Mockito的使用，有详细的api文档，具体可以查看：<a href="http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html" target="_blank" rel="noopener">http://site.mockito.org/mockito/docs/current/org/mockito/Mockito.html</a>，下面是整理的一些常用的使用方式。</p>
<h2 id="验证行为"><a href="#验证行为" class="headerlink" title="验证行为"></a>验证行为</h2><blockquote>
<p>一旦创建，mock会记录所有交互，你可以验证所有你想要验证的东西</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVerify</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//mock creation</span></span><br><span class="line">    List mockedList = mock(List.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//using mock object</span></span><br><span class="line">    mockedList.add(<span class="string">"one"</span>);</span><br><span class="line">    mockedList.add(<span class="string">"two"</span>);</span><br><span class="line">    mockedList.add(<span class="string">"two"</span>);</span><br><span class="line">    mockedList.clear();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//verification</span></span><br><span class="line">    verify(mockedList).add(<span class="string">"one"</span>);<span class="comment">//验证是否调用过一次 mockedList.add("one")方法，若不是（0次或者大于一次），测试将不通过</span></span><br><span class="line">    verify(mockedList, times(<span class="number">2</span>)).add(<span class="string">"two"</span>);</span><br><span class="line">    <span class="comment">//验证调用过2次 mockedList.add("two")方法，若不是，测试将不通过</span></span><br><span class="line">    verify(mockedList).clear();<span class="comment">//验证是否调用过一次 mockedList.clear()方法，若没有（0次或者大于一次），测试将不通过</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Stubbing"><a href="#Stubbing" class="headerlink" title="Stubbing"></a>Stubbing</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStubbing</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//你可以mock具体的类，而不仅仅是接口</span></span><br><span class="line">    LinkedList mockedList = mock(LinkedList.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置桩</span></span><br><span class="line">    when(mockedList.get(<span class="number">0</span>)).thenReturn(<span class="string">"first"</span>);</span><br><span class="line">    when(mockedList.get(<span class="number">1</span>)).thenThrow(<span class="keyword">new</span> RuntimeException());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印 "first"</span></span><br><span class="line">    System.out.println(mockedList.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里会抛runtime exception</span></span><br><span class="line">    System.out.println(mockedList.get(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里会打印 "null" 因为 get(999) 没有设置</span></span><br><span class="line">    System.out.println(mockedList.get(<span class="number">999</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Although it is possible to verify a stubbed invocation, usually it's just redundant</span></span><br><span class="line">    <span class="comment">//If your code cares what get(0) returns, then something else breaks (often even before verify() gets executed).</span></span><br><span class="line">    <span class="comment">//If your code doesn't care what get(0) returns, then it should not be stubbed. Not convinced? See here.</span></span><br><span class="line">    verify(mockedList).get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于stubbing，有以下几点需要注意：</p>
<ul>
<li>对于有返回值的方法，mock会默认返回null、空集合、默认值。比如，为int/Integer返回0，为boolean/Boolean返回false</li>
<li>stubbing可以被覆盖，但是请注意覆盖已有的stubbing有可能不是很好</li>
<li>一旦stubbing，不管调用多少次，方法都会永远返回stubbing的值</li>
<li>当你对同一个方法进行多次stubbing，最后一次stubbing是最重要的</li>
</ul>
<h2 id="参数匹配"><a href="#参数匹配" class="headerlink" title="参数匹配"></a>参数匹配</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testArgumentMatcher</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    LinkedList mockedList = mock(LinkedList.class);</span><br><span class="line">    <span class="comment">//用内置的参数匹配器来stub</span></span><br><span class="line">    when(mockedList.get(anyInt())).thenReturn(<span class="string">"element"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印 "element"</span></span><br><span class="line">    System.out.println(mockedList.get(<span class="number">999</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//你也可以用参数匹配器来验证，此处测试通过</span></span><br><span class="line">    verify(mockedList).get(anyInt());</span><br><span class="line">    <span class="comment">//此处测试将不通过，因为没调用get(33)</span></span><br><span class="line">    verify(mockedList).get(eq(<span class="number">33</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果你使用了参数匹配器，那么所有参数都应该使用参数匹配器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">verify(mock).someMethod(anyInt(), anyString(), eq(<span class="string">"third argument"</span>));</span><br><span class="line"><span class="comment">//上面是正确的，因为eq返回参数匹配器</span></span><br><span class="line"></span><br><span class="line">verify(mock).someMethod(anyInt(), anyString(), <span class="string">"third argument"</span>);</span><br><span class="line"><span class="comment">//上面将会抛异常，因为第三个参数不是参数匹配器，一旦使用了参数匹配器来验证，那么所有参数都应该使用参数匹配</span></span><br></pre></td></tr></table></figure>

<h2 id="验证准确的调用次数，最多、最少、从未等"><a href="#验证准确的调用次数，最多、最少、从未等" class="headerlink" title="验证准确的调用次数，最多、最少、从未等"></a>验证准确的调用次数，最多、最少、从未等</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInvocationTimes</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    LinkedList mockedList = mock(LinkedList.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//using mock</span></span><br><span class="line">    mockedList.add(<span class="string">"once"</span>);</span><br><span class="line"></span><br><span class="line">    mockedList.add(<span class="string">"twice"</span>);</span><br><span class="line">    mockedList.add(<span class="string">"twice"</span>);</span><br><span class="line"></span><br><span class="line">    mockedList.add(<span class="string">"three times"</span>);</span><br><span class="line">    mockedList.add(<span class="string">"three times"</span>);</span><br><span class="line">    mockedList.add(<span class="string">"three times"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面两个是等价的， 默认使用times(1)</span></span><br><span class="line">    verify(mockedList).add(<span class="string">"once"</span>);</span><br><span class="line">    verify(mockedList, times(<span class="number">1</span>)).add(<span class="string">"once"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证准确的调用次数</span></span><br><span class="line">    verify(mockedList, times(<span class="number">2</span>)).add(<span class="string">"twice"</span>);</span><br><span class="line">    verify(mockedList, times(<span class="number">3</span>)).add(<span class="string">"three times"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从未调用过. never()是times(0)的别名</span></span><br><span class="line">    verify(mockedList, never()).add(<span class="string">"never happened"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用atLeast()/atMost()验证</span></span><br><span class="line">    verify(mockedList, atLeastOnce()).add(<span class="string">"three times"</span>);</span><br><span class="line">    <span class="comment">//下面这句将不能通过测试</span></span><br><span class="line">    verify(mockedList, atLeast(<span class="number">2</span>)).add(<span class="string">"five times"</span>);</span><br><span class="line">    verify(mockedList, atMost(<span class="number">5</span>)).add(<span class="string">"three times"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="为void方法抛异常"><a href="#为void方法抛异常" class="headerlink" title="为void方法抛异常"></a>为void方法抛异常</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVoidMethodsWithExceptions</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    LinkedList mockedList = mock(LinkedList.class);</span><br><span class="line">    doThrow(<span class="keyword">new</span> RuntimeException()).when(mockedList).clear();</span><br><span class="line">    <span class="comment">//下面会抛RuntimeException</span></span><br><span class="line">    mockedList.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证调用顺序"><a href="#验证调用顺序" class="headerlink" title="验证调用顺序"></a>验证调用顺序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVerificationInOrder</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// A. Single mock whose methods must be invoked in a particular order</span></span><br><span class="line">    List singleMock = mock(List.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用单个mock对象</span></span><br><span class="line">    singleMock.add(<span class="string">"was added first"</span>);</span><br><span class="line">    singleMock.add(<span class="string">"was added second"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建inOrder</span></span><br><span class="line">    InOrder inOrder = inOrder(singleMock);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证调用次数，若是调换两句，将会出错，因为singleMock.add("was added first")是先调用的</span></span><br><span class="line">    inOrder.verify(singleMock).add(<span class="string">"was added first"</span>);</span><br><span class="line">    inOrder.verify(singleMock).add(<span class="string">"was added second"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多个mock对象</span></span><br><span class="line">    List firstMock = mock(List.class);</span><br><span class="line">    List secondMock = mock(List.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//using mocks</span></span><br><span class="line">    firstMock.add(<span class="string">"was called first"</span>);</span><br><span class="line">    secondMock.add(<span class="string">"was called second"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建多个mock对象的inOrder</span></span><br><span class="line">    inOrder = inOrder(firstMock, secondMock);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证firstMock先于secondMock调用</span></span><br><span class="line">    inOrder.verify(firstMock).add(<span class="string">"was called first"</span>);</span><br><span class="line">    inOrder.verify(secondMock).add(<span class="string">"was called second"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证mock对象没有产生过交互"><a href="#验证mock对象没有产生过交互" class="headerlink" title="验证mock对象没有产生过交互"></a>验证mock对象没有产生过交互</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInteractionNeverHappened</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List mockOne = mock(List.class);</span><br><span class="line">    List mockTwo = mock(List.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试通过</span></span><br><span class="line">    verifyZeroInteractions(mockOne, mockTwo);</span><br><span class="line"></span><br><span class="line">    mockOne.add(<span class="string">""</span>);</span><br><span class="line">    <span class="comment">//测试不通过，因为mockTwo已经发生过交互了</span></span><br><span class="line">    verifyZeroInteractions(mockOne, mockTwo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查找是否有未验证的交互"><a href="#查找是否有未验证的交互" class="headerlink" title="查找是否有未验证的交互"></a>查找是否有未验证的交互</h2><blockquote>
<p>不建议过多使用，api原文：A word of warning: Some users who did a lot of classic, expect-run-verify mocking tend to use verifyNoMoreInteractions() very often, even in every test method. verifyNoMoreInteractions() is not recommended to use in every test method. verifyNoMoreInteractions() is a handy assertion from the interaction testing toolkit. Use it only when it’s relevant. Abusing it leads to overspecified, less maintainable tests.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindingRedundantInvocations</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List mockedList = mock(List.class);</span><br><span class="line">    <span class="comment">//using mocks</span></span><br><span class="line">    mockedList.add(<span class="string">"one"</span>);</span><br><span class="line">    mockedList.add(<span class="string">"two"</span>);</span><br><span class="line"></span><br><span class="line">    verify(mockedList).add(<span class="string">"one"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//验证失败，因为mockedList.add("two")尚未验证</span></span><br><span class="line">    verifyNoMoreInteractions(mockedList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mock注解"><a href="#Mock注解" class="headerlink" title="@Mock注解"></a>@Mock注解</h2><ul>
<li>减少代码</li>
<li>增强可读性</li>
<li>让verify出错信息更易读，因为变量名可用来描述标记mock对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    List&lt;String&gt; mockedList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMocks</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//必须,否则注解无效</span></span><br><span class="line">        MockitoAnnotations.initMocks(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMock</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        mockedList.add(<span class="string">"one"</span>);</span><br><span class="line">        verify(mockedList).add(<span class="string">"one"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="根据调用顺序设置不同的stubbing"><a href="#根据调用顺序设置不同的stubbing" class="headerlink" title="根据调用顺序设置不同的stubbing"></a>根据调用顺序设置不同的stubbing</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">interface</span> <span class="title">MockTest</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">someMethod</span><span class="params">(String arg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStubbingConsecutiveCalls</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    MockTest mock = mock(MockTest.class);</span><br><span class="line">    when(mock.someMethod(<span class="string">"some arg"</span>)).thenThrow(<span class="keyword">new</span> RuntimeException(<span class="string">""</span>)).thenReturn(<span class="string">"foo"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一次调用，抛RuntimeException</span></span><br><span class="line">    mock.someMethod(<span class="string">"some arg"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二次调用返回foo</span></span><br><span class="line">    System.out.println(mock.someMethod(<span class="string">"some arg"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后续继续调用，返回“foo”，以最后一个stub为准</span></span><br><span class="line">    System.out.println(mock.someMethod(<span class="string">"some arg"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面是一个更简洁的写法</span></span><br><span class="line">    when(mock.someMethod(<span class="string">"some arg"</span>)).thenReturn(<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="doReturn-doThrow-doAnswer-doNothing-doCallRealMethod-等用法"><a href="#doReturn-doThrow-doAnswer-doNothing-doCallRealMethod-等用法" class="headerlink" title="doReturn()|doThrow()| doAnswer()|doNothing()|doCallRealMethod()等用法"></a>doReturn()|doThrow()| doAnswer()|doNothing()|doCallRealMethod()等用法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDoXXX</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List mockedList = mock(List.class);</span><br><span class="line">    doThrow(<span class="keyword">new</span> RuntimeException()).when(mockedList).clear();</span><br><span class="line">    <span class="comment">//以下会抛异常</span></span><br><span class="line">    mockedList.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="spy监视真正的对象"><a href="#spy监视真正的对象" class="headerlink" title="spy监视真正的对象"></a>spy监视真正的对象</h2><ul>
<li>spy是创建一个拷贝，如果你保留原始的list，并用它来进行操作，那么spy并不能检测到其交互</li>
<li>spy一个真正的对象+试图stub一个final方法，这样是会有问题的</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List list = <span class="keyword">new</span> LinkedList();</span><br><span class="line">    List spy = spy(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可选的，你可以stub某些方法</span></span><br><span class="line">    when(spy.size()).thenReturn(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用"真正"的方法</span></span><br><span class="line">    spy.add(<span class="string">"one"</span>);</span><br><span class="line">    spy.add(<span class="string">"two"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印one</span></span><br><span class="line">    System.out.println(spy.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//size()方法被stub了，打印100</span></span><br><span class="line">    System.out.println(spy.size());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可选，验证spy对象的行为</span></span><br><span class="line">    verify(spy).add(<span class="string">"one"</span>);</span><br><span class="line">    verify(spy).add(<span class="string">"two"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面写法有问题，spy.get(10)会抛IndexOutOfBoundsException异常</span></span><br><span class="line">    when(spy.get(<span class="number">10</span>)).thenReturn(<span class="string">"foo"</span>);</span><br><span class="line">    <span class="comment">//可用以下方式</span></span><br><span class="line">    doReturn(<span class="string">"foo"</span>).when(spy).get(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="为未stub的方法设置默认返回值"><a href="#为未stub的方法设置默认返回值" class="headerlink" title="为未stub的方法设置默认返回值"></a>为未stub的方法设置默认返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDefaultValue</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    List listOne = mock(List.class, Mockito.RETURNS_SMART_NULLS);</span><br><span class="line">    List listTwo = mock(List.class, <span class="keyword">new</span> Answer() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">answer</span><span class="params">(InvocationOnMock invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 2016/6/13 return default value here</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参数捕捉"><a href="#参数捕捉" class="headerlink" title="参数捕捉"></a>参数捕捉</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCapturingArguments</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List mockedList = mock(List.class);</span><br><span class="line">    ArgumentCaptor&lt;String&gt; argument = ArgumentCaptor.forClass(String.class);</span><br><span class="line">    mockedList.add(<span class="string">"John"</span>);</span><br><span class="line">    <span class="comment">//验证后再捕捉参数</span></span><br><span class="line">    verify(mockedList).add(argument.capture());</span><br><span class="line">    <span class="comment">//验证参数</span></span><br><span class="line">    assertEquals(<span class="string">"John"</span>, argument.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="真正的部分模拟（TODO：尚未搞清楚啥意思。。。）"><a href="#真正的部分模拟（TODO：尚未搞清楚啥意思。。。）" class="headerlink" title="真正的部分模拟（TODO：尚未搞清楚啥意思。。。）"></a>真正的部分模拟（TODO：尚未搞清楚啥意思。。。）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//you can create partial mock with spy() method:</span></span><br><span class="line">List list = spy(<span class="keyword">new</span> LinkedList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//you can enable partial mock capabilities selectively on mocks:</span></span><br><span class="line">Foo mock = mock(Foo.class);</span><br><span class="line"><span class="comment">//Be sure the real implementation is 'safe'.</span></span><br><span class="line"><span class="comment">//If real implementation throws exceptions or depends on specific state of the object then you're in trouble.</span></span><br><span class="line">when(mock.someMethod()).thenCallRealMethod();</span><br></pre></td></tr></table></figure>

<h2 id="重置mocks"><a href="#重置mocks" class="headerlink" title="重置mocks"></a>重置mocks</h2><blockquote>
<p>Don’t harm yourself. reset() in the middle of the test method is a code smell (you’re probably testing too much).</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReset</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List mock = mock(List.class);</span><br><span class="line">    when(mock.size()).thenReturn(<span class="number">10</span>);</span><br><span class="line">    mock.add(<span class="number">1</span>);</span><br><span class="line">    reset(mock);</span><br><span class="line">    <span class="comment">//从这开始，之前的交互和stub将全部失效</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Serializable-mocks"><a href="#Serializable-mocks" class="headerlink" title="Serializable mocks"></a>Serializable mocks</h2><blockquote>
<p>WARNING: This should be rarely used in unit testing.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSerializableMocks</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List serializableMock = mock(List.class, withSettings().serializable());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更多的注解：-Captor-Spy-InjectMocks"><a href="#更多的注解：-Captor-Spy-InjectMocks" class="headerlink" title="更多的注解：@Captor, @Spy, @InjectMocks"></a>更多的注解：@Captor, @Spy, @InjectMocks</h2><ul>
<li>@Captor 创建ArgumentCaptor</li>
<li>@Spy 可以代替spy(Object).</li>
<li>@InjectMocks 如果此注解声明的变量需要用到mock对象，mockito会自动注入mock或spy成员</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可以这样写</span></span><br><span class="line"><span class="meta">@Spy</span> BeerDrinker drinker = <span class="keyword">new</span> BeerDrinker();</span><br><span class="line"><span class="comment">//也可以这样写，mockito会自动实例化drinker</span></span><br><span class="line"><span class="meta">@Spy</span> BeerDrinker drinker;</span><br><span class="line"></span><br><span class="line"><span class="comment">//会自动实例化</span></span><br><span class="line"><span class="meta">@InjectMocks</span> LocalPub;</span><br></pre></td></tr></table></figure>

<h2 id="超时验证"><a href="#超时验证" class="headerlink" title="超时验证"></a>超时验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">interface</span> <span class="title">TimeMockTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTimeout</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    TimeMockTest mock = mock(TimeMockTest.class);</span><br><span class="line">    <span class="comment">//测试程序将会在下面这句阻塞100毫秒，timeout的时候再进行验证是否执行过someMethod()</span></span><br><span class="line">    verify(mock, timeout(<span class="number">100</span>)).someMethod();</span><br><span class="line">    <span class="comment">//和上面代码等价</span></span><br><span class="line">    verify(mock, timeout(<span class="number">100</span>).times(<span class="number">1</span>)).someMethod();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//阻塞100ms，timeout的时候再验证是否刚好执行了2次</span></span><br><span class="line">    verify(mock, timeout(<span class="number">100</span>).times(<span class="number">2</span>)).someMethod();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//timeout的时候，验证至少执行了2次</span></span><br><span class="line">    verify(mock, timeout(<span class="number">100</span>).atLeast(<span class="number">2</span>)).someMethod();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//timeout时间后，用自定义的检验模式验证someMethod()</span></span><br><span class="line">    VerificationMode yourOwnVerificationMode = <span class="keyword">new</span> VerificationMode() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(VerificationData data)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> 2016/12/4 implement me</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    verify(mock, <span class="keyword">new</span> Timeout(<span class="number">100</span>, yourOwnVerificationMode)).someMethod();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查看是否mock或者spy"><a href="#查看是否mock或者spy" class="headerlink" title="查看是否mock或者spy"></a>查看是否mock或者spy</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mockito.mockingDetails(someObject).isMock();</span><br><span class="line">Mockito.mockingDetails(someObject).isSpy();</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          
        
        <div class="post-tags">
            <a href="/tags/mock/" rel="tag"># mock</a>
          
            <a href="/tags/Mockito/" rel="tag"># Mockito</a>
          
            <a href="/tags/单元测试/" rel="tag"># 单元测试</a>
          
        </div>
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/2016/06/20/moco/" rel="next" title="Mock Server利器 - Moco">
                <i class="fa fa-chevron-left"></i> Mock Server利器 - Moco
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
              <a href="/2016/07/12/mock-web-server/" rel="prev" title="MockWebServer使用指南">
                MockWebServer使用指南 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="chenhang">
  <p class="site-author-name" itemprop="name">chenhang</p>
  <div class="site-description motion-element" itemprop="description">博观而约取，厚积而薄发。</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/shensky711" title="GitHub &rarr; https://github.com/shensky711" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:shensky711@gmail.com" title="E-Mail &rarr; mailto:shensky711@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#mock和Mockito的关系"><span class="nav-number">1.</span> <span class="nav-text">mock和Mockito的关系</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mockito使用举例"><span class="nav-number">2.</span> <span class="nav-text">Mockito使用举例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android-Studio工程配置Mockito"><span class="nav-number">3.</span> <span class="nav-text">Android Studio工程配置Mockito</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mockito使用方法"><span class="nav-number">4.</span> <span class="nav-text">Mockito使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#验证行为"><span class="nav-number">4.1.</span> <span class="nav-text">验证行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Stubbing"><span class="nav-number">4.2.</span> <span class="nav-text">Stubbing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数匹配"><span class="nav-number">4.3.</span> <span class="nav-text">参数匹配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证准确的调用次数，最多、最少、从未等"><span class="nav-number">4.4.</span> <span class="nav-text">验证准确的调用次数，最多、最少、从未等</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为void方法抛异常"><span class="nav-number">4.5.</span> <span class="nav-text">为void方法抛异常</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证调用顺序"><span class="nav-number">4.6.</span> <span class="nav-text">验证调用顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证mock对象没有产生过交互"><span class="nav-number">4.7.</span> <span class="nav-text">验证mock对象没有产生过交互</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查找是否有未验证的交互"><span class="nav-number">4.8.</span> <span class="nav-text">查找是否有未验证的交互</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mock注解"><span class="nav-number">4.9.</span> <span class="nav-text">@Mock注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#根据调用顺序设置不同的stubbing"><span class="nav-number">4.10.</span> <span class="nav-text">根据调用顺序设置不同的stubbing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#doReturn-doThrow-doAnswer-doNothing-doCallRealMethod-等用法"><span class="nav-number">4.11.</span> <span class="nav-text">doReturn()|doThrow()| doAnswer()|doNothing()|doCallRealMethod()等用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spy监视真正的对象"><span class="nav-number">4.12.</span> <span class="nav-text">spy监视真正的对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为未stub的方法设置默认返回值"><span class="nav-number">4.13.</span> <span class="nav-text">为未stub的方法设置默认返回值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数捕捉"><span class="nav-number">4.14.</span> <span class="nav-text">参数捕捉</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#真正的部分模拟（TODO：尚未搞清楚啥意思。。。）"><span class="nav-number">4.15.</span> <span class="nav-text">真正的部分模拟（TODO：尚未搞清楚啥意思。。。）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重置mocks"><span class="nav-number">4.16.</span> <span class="nav-text">重置mocks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serializable-mocks"><span class="nav-number">4.17.</span> <span class="nav-text">Serializable mocks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更多的注解：-Captor-Spy-InjectMocks"><span class="nav-number">4.18.</span> <span class="nav-text">更多的注解：@Captor, @Spy, @InjectMocks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#超时验证"><span class="nav-number">4.19.</span> <span class="nav-text">超时验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看是否mock或者spy"><span class="nav-number">4.20.</span> <span class="nav-text">查看是否mock或者spy</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenhang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">234k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">3:33</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
    
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>

  
  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>



  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>



  <script src="/js/next-boot.js?v=7.3.0"></script>

  

  

  


  























  <script src="/js/local-search.js?v=7.3.0"></script>













    
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'ST1hmgzJfF6c44BNUyK56qad-gzGzoHsz',
    appKey: 'Wy4dwHBHU556tTDardpzBI3i',
    placeholder: '说点什么吧~',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn'
  });
</script>


</body>
</html>
