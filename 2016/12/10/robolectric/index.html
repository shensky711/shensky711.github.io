<!DOCTYPE html>





<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">
  <meta name="google-site-verification" content="bMH0URCoOdzdhSMyGeDuGebWiSxHnJsOLundsaPEZbc">
  <meta name="msvalidate.01" content="EC8F55291A196E9DD39DDDB134E93A69">
  <meta name="baidu-site-verification" content="QC6bRBu8qm">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: 'search.xml'
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="概述Android的单元测试可以分为两部分：  Local unit tests：运行于本地JVM Instrumented test：运行于真机或者模拟器  如果使用Local测试，需要保证测试过程中不会调用Android系统API，否则会抛出RuntimeException异常，因为Local测试是直接跑在本机JVM的，而之所以我们能使用Android系统API，是因为编译的时候，我们依赖了一">
<meta name="keywords" content="单元测试,Robolectric">
<meta property="og:type" content="article">
<meta property="og:title" content="Robolectric使用教程">
<meta property="og:url" content="http://blog.hanschen.site/2016/12/10/robolectric/index.html">
<meta property="og:site_name" content="HansChen 的博客">
<meta property="og:description" content="概述Android的单元测试可以分为两部分：  Local unit tests：运行于本地JVM Instrumented test：运行于真机或者模拟器  如果使用Local测试，需要保证测试过程中不会调用Android系统API，否则会抛出RuntimeException异常，因为Local测试是直接跑在本机JVM的，而之所以我们能使用Android系统API，是因为编译的时候，我们依赖了一">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-09-02T06:30:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Robolectric使用教程">
<meta name="twitter:description" content="概述Android的单元测试可以分为两部分：  Local unit tests：运行于本地JVM Instrumented test：运行于真机或者模拟器  如果使用Local测试，需要保证测试过程中不会调用Android系统API，否则会抛出RuntimeException异常，因为Local测试是直接跑在本机JVM的，而之所以我们能使用Android系统API，是因为编译的时候，我们依赖了一">
  <link rel="alternate" href="/atom.xml" title="HansChen 的博客" type="application/atom+xml">
  <link rel="canonical" href="http://blog.hanschen.site/2016/12/10/robolectric/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Robolectric使用教程 | HansChen 的博客</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HansChen 的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        <li class="menu-item menu-item-search">
          <a href="javascript:;" class="popup-trigger">
          
            <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


    </div>
</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.hanschen.site/2016/12/10/robolectric/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenhang">
      <meta itemprop="description" content="博观而约取，厚积而薄发。">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HansChen 的博客">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">Robolectric使用教程

              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-10T00:00:00+08:00">2016-12-10</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-09-02 14:30:29" itemprop="dateModified" datetime="2019-09-02T14:30:29+08:00">2019-09-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/测试/" itemprop="url" rel="index"><span itemprop="name">测试</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon"
              >
                <i class="fa fa-eye"></i>
                 阅读次数： 
                <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
              </span>
            </span>
          
            
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="fa fa-comment-o"></i>
    </span>
    
      <span class="post-meta-item-text">评论数：</span>
    
  
    <a href="/2016/12/10/robolectric/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2016/12/10/robolectric/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
          <br>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">本文字数：</span>
              
              <span title="本文字数">17k</span>
            </span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              
              <span title="阅读时长">15 分钟</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>Android的单元测试可以分为两部分：</p>
<ol>
<li>Local unit tests：运行于本地JVM</li>
<li>Instrumented test：运行于真机或者模拟器</li>
</ol>
<p>如果使用Local测试，需要保证测试过程中不会调用Android系统API，否则会抛出RuntimeException异常，因为Local测试是直接跑在本机JVM的，而之所以我们能使用Android系统API，是因为编译的时候，我们依赖了一个名为“android.jar”的jar包，但是jar包里所有方法都是直接抛出了一个RuntimeException，是没有任何任何实现的，这只是Android为了我们能通过编译提供的一个Stub！当APP运行在真实的Android系统的时候，由于类加载机制，会加载位于framework的具有真正实现的类。由于我们的Local是直接在PC上运行的，所以调用这些系统API便会出错。<br>那么问题来了，我们既要使用Local测试，但测试过程又难免遇到调用系统API那怎么办？其中一个方法就是mock objects，比如借助Mockito，另外一种方式就是使用<code>Robolectric</code>， Robolectric就是为解决这个问题而生的。它实现一套JVM能运行的Android代码，然后在unit test运行的时候去截取android相关的代码调用，然后转到他们的他们实现的Shadow代码去执行这个调用的过程</p>
<a id="more"></a>

<h1 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h1><h2 id="为项目添加依赖"><a href="#为项目添加依赖" class="headerlink" title="为项目添加依赖"></a>为项目添加依赖</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testCompile <span class="string">"org.robolectric:robolectric:3.1.4"</span></span><br></pre></td></tr></table></figure>

<p>Robolectric在第一次运行时，会下载一些sdk依赖包，每个sdk依赖包大概50M，下载速度比较慢，用户可以直接在网上下载相应依赖包，放置在本地maven仓库地址中，默认路径为：<code>C:\Users\username\.m2\repository\org\robolectric</code></p>
<h2 id="指定RobolectricTestRunner为运行器"><a href="#指定RobolectricTestRunner为运行器" class="headerlink" title="指定RobolectricTestRunner为运行器"></a>指定RobolectricTestRunner为运行器</h2><p>为测试用例添加注解,指定测试运行器为RobolectricTestRunner。注意，这里要通过Config指定<code>constants = BuildConfig.class</code>，Robolectric 会通过constants推导出输出路径，如果不进行配置，Robolectric可能不能找到你的manifest、resources和assets资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</span><br><span class="line"><span class="meta">@Config</span>(constants = BuildConfig.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="什么是Shadow类"><a href="#什么是Shadow类" class="headerlink" title="什么是Shadow类"></a>什么是Shadow类</h2><p>Shadow是Robolectric的立足之本，如其名，作为影子，一定是变幻莫测，时有时无，且依存于本尊。Robolectric定义了大量模拟Android系统类行为的Shadow类，当这些系统类被创建的时候，Robolectric会查找对应的Shadow类并创建一个Shadow类与原始类关联。每当系统类的方法被调用的时候，Robolectric会保证Shadow对应的方法会调用。这些Shadow对象，丰富了本尊的行为，能更方便的对Android相关的对象进行测试。<br>比如，我们可以借助ShadowActivity验证页面是否正确跳转了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证点击事件是否触发了页面跳转，验证目标页面是否预期页面</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJump</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 默认会调用Activity的生命周期: onCreate-&gt;onStart-&gt;onResume</span></span><br><span class="line">    MainActivity activity = Robolectric.setupActivity(MainActivity.class);</span><br><span class="line">    <span class="comment">// 触发按钮点击</span></span><br><span class="line">    activity.findViewById(R.id.activity_main_jump).performClick();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对应的Shadow类</span></span><br><span class="line">    ShadowActivity shadowActivity = Shadows.shadowOf(activity);</span><br><span class="line">    <span class="comment">// 借助Shadow类获取启动下一Activity的Intent</span></span><br><span class="line">    Intent nextIntent = shadowActivity.getNextStartedActivity();</span><br><span class="line">    <span class="comment">// 校验Intent的正确性</span></span><br><span class="line">    assertEquals(nextIntent.getComponent().getClassName(), SecondActivity.class.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Config配置"><a href="#Config配置" class="headerlink" title="@Config配置"></a>@Config配置</h2><p>可以通过<code>@Config</code>定制Robolectric的运行时的行为。这个注解可以用来注释类和方法，如果类和方法同时使用了@Config，那么方法的设置会覆盖类的设置。你可以创建一个基类，用@Config配置测试参数，这样，其他测试用例就可以共享这个配置了</p>
<h2 id="配置SDK版本"><a href="#配置SDK版本" class="headerlink" title="配置SDK版本"></a>配置SDK版本</h2><p>Robolectric会根据manifest文件配置的targetSdkVersion选择运行测试代码的SDK版本，如果你想指定sdk来运行测试用例，可以通过下面的方式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Config</span>(sdk = Build.VERSION_CODES.JELLY_BEAN)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Config</span>(sdk = Build.VERSION_CODES.KITKAT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSandwich_shouldReturnHamSandwich</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置Application类"><a href="#配置Application类" class="headerlink" title="配置Application类"></a>配置Application类</h2><p>Robolectric会根据manifest文件配置的Application配置去实例化一个Application类，如果你想在测试用例中重新指定，可以通过下面的方式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Config</span>(application = CustomApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Config</span>(application = CustomApplicationOverride.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSandwich_shouldReturnHamSandwich</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指定Resource路径"><a href="#指定Resource路径" class="headerlink" title="指定Resource路径"></a>指定Resource路径</h2><p>Robolectric可以让你配置manifest、resource和assets路径，可以通过下面的方式配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Config</span>(manifest = <span class="string">"some/build/path/AndroidManifest.xml"</span>,</span><br><span class="line">        assetDir = <span class="string">"some/build/path/assetDir"</span>,</span><br><span class="line">        resourceDir = <span class="string">"some/build/path/resourceDir"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Config</span>(manifest = <span class="string">"other/build/path/AndroidManifest.xml"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getSandwich_shouldReturnHamSandwich</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用第三方Library-Resources"><a href="#使用第三方Library-Resources" class="headerlink" title="使用第三方Library Resources"></a>使用第三方Library Resources</h2><p>当Robolectric测试的时候，会尝试加载所有应用提供的资源，但如果你需要使用第三方库中提供的资源文件，你可能需要做一些特别的配置。不过如果你使用gradle来构建Android应用，这些配置就不需要做了，因为Gradle Plugin会在build的时候自动合并第三方库的资源，但如果你使用的是Maven，那么你需要配置libraries变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</span><br><span class="line"><span class="meta">@Config</span>(libraries = &#123;</span><br><span class="line">    <span class="string">"build/unpacked-libraries/library1"</span>,</span><br><span class="line">    <span class="string">"build/unpacked-libraries/library2"</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SandwichTest</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用限定的资源文件"><a href="#使用限定的资源文件" class="headerlink" title="使用限定的资源文件"></a>使用限定的资源文件</h2><p>Android会在运行时加载特定的资源文件，如根据设备屏幕加载不同分辨率的图片资源、根据系统语言加载不同的string.xml，在Robolectric测试当中，你也可以进行一个限定，让测试程序加载特定资源.多个限定条件可以用破折号拼接在在一起。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用qualifiers加载对应的资源文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Config</span>(qualifiers = <span class="string">"zh-rCN"</span>)</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testString</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Context context = RuntimeEnvironment.application;</span><br><span class="line">    assertThat(context.getString(R.string.app_name), is(<span class="string">"单元测试Demo"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Properties文件"><a href="#Properties文件" class="headerlink" title="Properties文件"></a>Properties文件</h2><p>如果你嫌通过注解配置上面的东西麻烦，你也可以把以上配置放在一个Properties文件之中，然后通过@Config指定配置文件，比如，首先创建一个配置文件robolectric.properties:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 放置Robolectric的配置选项:</span><br><span class="line">sdk=21</span><br><span class="line">manifest=some/build/path/AndroidManifest.xml</span><br><span class="line">assetDir=some/build/path/assetDir</span><br><span class="line">resourceDir=some/build/path/resourceDir</span><br></pre></td></tr></table></figure>

<p>然后把robolectric.properties文件放到src/test/resources目录下，运行的时候，会自动加载里面的配置</p>
<h2 id="系统属性配置"><a href="#系统属性配置" class="headerlink" title="系统属性配置"></a>系统属性配置</h2><ul>
<li>robolectric.offline：true代表关闭运行时获取jar包</li>
<li>robolectric.dependency.dir：当处于offline模式的时候，指定运行时的依赖目录</li>
<li>robolectric.dependency.repo.id：设置运行时获取依赖的Maven仓库ID，默认是sonatype</li>
<li>robolectric.dependency.repo.url：设置运行时依赖的Maven仓库地址，默认是<a href="https://oss.sonatype.org/content/groups/public/" target="_blank" rel="noopener">https://oss.sonatype.org/content/groups/public/</a></li>
<li>robolectric.logging.enabled：设置是否打开调试开关</li>
</ul>
<p>以上设置可以通过Gradle进行配置，如：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line"></span><br><span class="line">    testOptions &#123;</span><br><span class="line">        unitTests.all &#123;</span><br><span class="line">            systemProperty <span class="string">'robolectric.dependency.repo.url'</span>, <span class="string">'https://local-mirror/repo'</span></span><br><span class="line">            systemProperty <span class="string">'robolectric.dependency.repo.id'</span>, <span class="string">'local'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="驱动Activity生命周期"><a href="#驱动Activity生命周期" class="headerlink" title="驱动Activity生命周期"></a>驱动Activity生命周期</h2><p>利用<code>ActivityController</code>我们可以让Activity执行相应的生命周期方法，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLifecycle</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 创建Activity控制器</span></span><br><span class="line">    ActivityController&lt;MainActivity&gt; controller = Robolectric.buildActivity(MainActivity.class);</span><br><span class="line">    MainActivity activity = controller.get();</span><br><span class="line">    assertNull(activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performCreate方法</span></span><br><span class="line">    controller.create();</span><br><span class="line">    assertEquals(<span class="string">"onCreate"</span>, activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performStart方法</span></span><br><span class="line">    controller.start();</span><br><span class="line">    assertEquals(<span class="string">"onStart"</span>, activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performResume方法</span></span><br><span class="line">    controller.resume();</span><br><span class="line">    assertEquals(<span class="string">"onResume"</span>, activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performPause方法</span></span><br><span class="line">    controller.pause();</span><br><span class="line">    assertEquals(<span class="string">"onPause"</span>, activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performStop方法</span></span><br><span class="line">    controller.stop();</span><br><span class="line">    assertEquals(<span class="string">"onStop"</span>, activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performRestart方法</span></span><br><span class="line">    controller.restart();</span><br><span class="line">    <span class="comment">// 注意此处应该是onStart，因为performRestart不仅会调用restart，还会调用onStart</span></span><br><span class="line">    assertEquals(<span class="string">"onStart"</span>, activity.getLifecycleState());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performDestroy方法</span></span><br><span class="line">    controller.destroy();</span><br><span class="line">    assertEquals(<span class="string">"onDestroy"</span>, activity.getLifecycleState());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过ActivityController，我们可以模拟各种生命周期的变化。但是要注意，我们虽然可以随意调用Activity的生命周期，但是Activity生命周期切换有自己的检测机制，我们要遵循Activity的生命周期规律。比如，如果当前Activity并非处于stop状态，测试代码去调用了controller.restart方法，此时Activity是不会回调onRestart和onStart的。</p>
<p>除了控制生命周期，还可以在启动Activity的时候传递Intent：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动Activity的时候传递Intent</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStartActivityWithIntent</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">    intent.putExtra(<span class="string">"test"</span>, <span class="string">"HelloWorld"</span>);</span><br><span class="line">    Activity activity = Robolectric.buildActivity(MainActivity.class).withIntent(intent).create().get();</span><br><span class="line">    assertEquals(<span class="string">"HelloWorld"</span>, activity.getIntent().getExtras().getString(<span class="string">"test"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>onRestoreInstanceState回调中传递Bundle：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * savedInstanceState会在onRestoreInstanceState回调中传递给Activity</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSavedInstanceState</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Bundle savedInstanceState = <span class="keyword">new</span> Bundle();</span><br><span class="line">    Robolectric.buildActivity(MainActivity.class).create().restoreInstanceState(savedInstanceState).get();</span><br><span class="line">    <span class="comment">// verify something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在真实环境下，视图是在onCreate之后的某一时刻在attach到Window上的，在此之前，View是处于不可操作状态的，你不能点击它。在Activity的onPostResume方法调用之后，View才会attach到Window之中。但是，在Robolectric之中，我们可以用控制器的<code>visible</code>方法使得View变为可见，变为可见之后，就可以模拟点击事件了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVisible</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ActivityController&lt;MainActivity&gt; controller = Robolectric.buildActivity(MainActivity.class);</span><br><span class="line">    MainActivity activity = controller.get();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用Activity的performCreate并且设置视图visible</span></span><br><span class="line">    controller.create().visible();</span><br><span class="line">    <span class="comment">// 触发点击</span></span><br><span class="line">    activity.findViewById(R.id.activity_main_button1).performClick();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证</span></span><br><span class="line">    assertEquals(shadowOf(activity).getNextStartedActivity().getComponent().getClassName(), SecondActivity.class.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="追加模块"><a href="#追加模块" class="headerlink" title="追加模块"></a>追加模块</h2><p>为了减少依赖包的大小，Robolectric的shadows类成了好几部分：</p>
<table>
<thead>
<tr>
<th>SDK Package</th>
<th>Robolectric Add-On Package</th>
</tr>
</thead>
<tbody><tr>
<td>com.android.support.support-v4</td>
<td>org.robolectric:shadows-support-v4</td>
</tr>
<tr>
<td>com.android.support.multidex</td>
<td>org.robolectric:shadows-multidex</td>
</tr>
<tr>
<td>com.google.android.gms:play-services</td>
<td>org.robolectric:shadows-play-services</td>
</tr>
<tr>
<td>com.google.android.maps:maps</td>
<td>org.robolectric:shadows-maps</td>
</tr>
<tr>
<td>org.apache.httpcomponents:httpclient</td>
<td>org.robolectric:shadows-httpclient</td>
</tr>
</tbody></table>
<p>用户可以根据自身需求添加以下依赖包，如</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    ... ...</span><br><span class="line">    testCompile <span class="string">'org.robolectric:robolectric:3.1.4'</span></span><br><span class="line">    testCompile <span class="string">'org.robolectric:shadows-support-v4:3.1.4'</span></span><br><span class="line">    testCompile <span class="string">'org.robolectric:shadows-multidex:3.1.4'</span></span><br><span class="line">    testCompile <span class="string">'org.robolectric:shadows-play-services:3.1.4'</span></span><br><span class="line">    testCompile <span class="string">'org.robolectric:shadows-maps:3.1.4'</span></span><br><span class="line">    testCompile <span class="string">'org.robolectric:shadows-httpclient:3.1.4'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义Shadow类"><a href="#自定义Shadow类" class="headerlink" title="自定义Shadow类"></a>自定义Shadow类</h2><ol>
<li>Shadow类需要一个public的无参构造方法以方便Robolectric框架可以实例化它，通过@Implements注解与原始类关联在一起</li>
<li>若原始类有<code>有参构造方法</code>，在Shadow类中定义public void类型的名为<code>__constructor__</code>的方法，且方法参数与原始类的构造方法参数一直</li>
<li>定义与原始类方法签名一致的方法，在里面重写实现，Shadow方法需用@Implementation进行注解</li>
</ol>
<p>下面我们来创建RobolectricBean的Shadow类<br>原始类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RobolectricBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span>    color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RobolectricBean</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(<span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Shadow类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建&#123;<span class="doctag">@link</span> RobolectricBean&#125;的影子类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> HansChen</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Implements</span>(RobolectricBean.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShadowRobolectricBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过<span class="doctag">@RealObject</span>注解可以访问原始对象，但注意，通过<span class="doctag">@RealObject</span>注解的变量调用方法，依然会调用Shadow类的方法，而不是原始类的方法</span></span><br><span class="line"><span class="comment">     * 只能用来访问原始类的field</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RealObject</span></span><br><span class="line">    RobolectricBean realBean;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要一个无参构造方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShadowRobolectricBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对应原始类的构造方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 对应原始类构造方法的传入参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">__constructor__</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        realBean.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 原始对象的方法被调用的时候，Robolectric会根据方法签名查找对应的Shadow方法并调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Implementation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello, I ma shadow of RobolectricBean: "</span> + realBean.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Implementation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getColor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> realBean.color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Implementation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(<span class="keyword">int</span> color)</span> </span>&#123;</span><br><span class="line">        realBean.color = color;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Shadow类中访问原始类的field"><a href="#Shadow类中访问原始类的field" class="headerlink" title="Shadow类中访问原始类的field"></a>Shadow类中访问原始类的field</h2><p>Shadow类中可以定义一个原始类的成员变量，并用@RealObject注解，这样，Shadow类就能访问原始类的field了，但是注意，通过@RealObject注解的变量调用方法，依然会调用Shadow类的方法，而不是原始类的方法，只能用它来访问原始类的field。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Implements</span>(Point.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShadowPoint</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RealObject</span> <span class="keyword">private</span> Point realPoint;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">__constructor__</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">        realPoint.x = x;</span><br><span class="line">        realPoint.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="如何在测试用例中让Shadow生效"><a href="#如何在测试用例中让Shadow生效" class="headerlink" title="如何在测试用例中让Shadow生效"></a>如何在测试用例中让Shadow生效</h2><p>在Config注解中添加<code>shadows</code>参数，指定对应的Shadow生效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</span><br><span class="line"><span class="meta">@Config</span>(shadows = ShadowRobolectricBean.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RobolectricBeanTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，自定义的Shadow类不能通过<code>Shadows.shadowOf()</code>获取，需要用<code>ShadowExtractor.extract()</code>来获取，获取之后进行类型转换:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShadowRobolectricBean shadowBean = (ShadowRobolectricBean) ShadowExtractor.extract(bean);</span><br></pre></td></tr></table></figure>

<h1 id="常用测试场景"><a href="#常用测试场景" class="headerlink" title="常用测试场景"></a>常用测试场景</h1><h2 id="页面跳转验证"><a href="#页面跳转验证" class="headerlink" title="页面跳转验证"></a>页面跳转验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证点击事件是否触发了页面跳转，验证目标页面是否预期页面</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJump</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 默认会调用Activity的生命周期: onCreate-&gt;onStart-&gt;onResume</span></span><br><span class="line">    MainActivity activity = Robolectric.setupActivity(MainActivity.class);</span><br><span class="line">    <span class="comment">// 触发按钮点击</span></span><br><span class="line">    activity.findViewById(R.id.activity_main_jump).performClick();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取对应的Shadow类</span></span><br><span class="line">    ShadowActivity shadowActivity = Shadows.shadowOf(activity);</span><br><span class="line">    <span class="comment">// 借助Shadow类获取启动下一Activity的Intent</span></span><br><span class="line">    Intent nextIntent = shadowActivity.getNextStartedActivity();</span><br><span class="line">    <span class="comment">// 校验Intent的正确性</span></span><br><span class="line">    assertEquals(nextIntent.getComponent().getClassName(), SecondActivity.class.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UI组件状态验证"><a href="#UI组件状态验证" class="headerlink" title="UI组件状态验证"></a>UI组件状态验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证UI组件状态</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCheckBoxState</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    MainActivity activity = Robolectric.setupActivity(MainActivity.class);</span><br><span class="line">    CheckBox checkBox = (CheckBox) activity.findViewById(R.id.activity_main_check_box);</span><br><span class="line">    <span class="comment">// 验证CheckBox初始状态</span></span><br><span class="line">    assertFalse(checkBox.isChecked());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击按钮反转CheckBox状态</span></span><br><span class="line">    activity.findViewById(R.id.activity_main_switch_check_box).performClick();</span><br><span class="line">    <span class="comment">// 验证状态是否正确</span></span><br><span class="line">    assertTrue(checkBox.isChecked());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击按钮反转CheckBox状态</span></span><br><span class="line">    activity.findViewById(R.id.activity_main_switch_check_box).performClick();</span><br><span class="line">    <span class="comment">// 验证状态是否正确</span></span><br><span class="line">    assertFalse(checkBox.isChecked());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证Dialog"><a href="#验证Dialog" class="headerlink" title="验证Dialog"></a>验证Dialog</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证Dialog是否正确弹出</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDialog</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    MainActivity activity = Robolectric.setupActivity(MainActivity.class);</span><br><span class="line">    AlertDialog dialog = ShadowAlertDialog.getLatestAlertDialog();</span><br><span class="line">    <span class="comment">// 判断Dialog尚未弹出</span></span><br><span class="line">    assertNull(dialog);</span><br><span class="line"></span><br><span class="line">    activity.findViewById(R.id.activity_main_show_dialog).performClick();</span><br><span class="line">    dialog = ShadowAlertDialog.getLatestAlertDialog();</span><br><span class="line">    <span class="comment">// 判断Dialog已经弹出</span></span><br><span class="line">    assertNotNull(dialog);</span><br><span class="line">    <span class="comment">// 获取Shadow类进行验证</span></span><br><span class="line">    ShadowAlertDialog shadowDialog = shadowOf(dialog);</span><br><span class="line">    assertEquals(<span class="string">"AlertDialog"</span>, shadowDialog.getTitle());</span><br><span class="line">    assertEquals(<span class="string">"Oops, now you see me ~"</span>, shadowDialog.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证Toast"><a href="#验证Toast" class="headerlink" title="验证Toast"></a>验证Toast</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 验证Toast是否正确弹出</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testToast</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    MainActivity activity = Robolectric.setupActivity(MainActivity.class);</span><br><span class="line">    Toast toast = ShadowToast.getLatestToast();</span><br><span class="line">    <span class="comment">// 判断Toast尚未弹出</span></span><br><span class="line">    assertNull(toast);</span><br><span class="line"></span><br><span class="line">    activity.findViewById(R.id.activity_main_show_toast).performClick();</span><br><span class="line">    toast = ShadowToast.getLatestToast();</span><br><span class="line">    <span class="comment">// 判断Toast已经弹出</span></span><br><span class="line">    assertNotNull(toast);</span><br><span class="line">    <span class="comment">// 获取Shadow类进行验证</span></span><br><span class="line">    ShadowToast shadowToast = shadowOf(toast);</span><br><span class="line">    assertEquals(Toast.LENGTH_SHORT, shadowToast.getDuration());</span><br><span class="line">    assertEquals(<span class="string">"oops"</span>, ShadowToast.getTextOfLatestToast());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证Fragment"><a href="#验证Fragment" class="headerlink" title="验证Fragment"></a>验证Fragment</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</span><br><span class="line"><span class="meta">@Config</span>(constants = BuildConfig.class, application = CustomApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFragmentTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MyFragment myFragment;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        myFragment = <span class="keyword">new</span> MyFragment();</span><br><span class="line">        <span class="comment">// 把Fragment添加到Activity中</span></span><br><span class="line">        FragmentTestUtil.startFragment(myFragment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFragment</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertNotNull(myFragment.getView());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证BroadcastReceiver"><a href="#验证BroadcastReceiver" class="headerlink" title="验证BroadcastReceiver"></a>验证BroadcastReceiver</h2><p>首先看下广播接收器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>广播的测试点可以包含两个方面</p>
<ol>
<li>验证应用程序是否注册了该广播</li>
<li>验证广播接收器的处理逻辑是否正确，关于逻辑是否正确，可以直接人为的触发onReceive()方法，让然后进行验证</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</span><br><span class="line"><span class="meta">@Config</span>(constants = BuildConfig.class, application = CustomApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReceiverTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restRegister</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ShadowApplication shadowApplication = ShadowApplication.getInstance();</span><br><span class="line"></span><br><span class="line">        String action = <span class="string">"ut.cn.unittestdemo.receiver"</span>;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(action);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证是否注册了相应的Receiver</span></span><br><span class="line">        assertTrue(shadowApplication.hasReceiverForIntent(intent));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restReceive</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        String action = <span class="string">"ut.cn.unittestdemo.receiver"</span>;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(action);</span><br><span class="line">        intent.putExtra(<span class="string">"EXTRA_USERNAME"</span>, <span class="string">"HansChen"</span>);</span><br><span class="line"></span><br><span class="line">        MyReceiver myReceiver = <span class="keyword">new</span> MyReceiver();</span><br><span class="line">        myReceiver.onReceive(RuntimeEnvironment.application, intent);</span><br><span class="line">        <span class="comment">// verify something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="验证Service"><a href="#验证Service" class="headerlink" title="验证Service"></a>验证Service</h2><p>Service和Activity一样，都有生命周期，Robolectric也提供了Service的生命周期控制器，使用方式和Activity类似，这里就不做详细解释了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(RobolectricTestRunner.class)</span><br><span class="line"><span class="meta">@Config</span>(constants = BuildConfig.class, application = CustomApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServiceController&lt;TestService&gt; controller;</span><br><span class="line">    <span class="keyword">private</span> TestService                    testService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        controller = Robolectric.buildService(TestService.class);</span><br><span class="line">        testService = controller.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 控制Service生命周期进行验证</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLifecycle</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        controller.create();</span><br><span class="line">        <span class="comment">// verify something</span></span><br><span class="line"></span><br><span class="line">        controller.startCommand(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// verify something</span></span><br><span class="line"></span><br><span class="line">        controller.bind();</span><br><span class="line">        <span class="comment">// verify something</span></span><br><span class="line"></span><br><span class="line">        controller.unbind();</span><br><span class="line">        <span class="comment">// verify something</span></span><br><span class="line"></span><br><span class="line">        controller.destroy();</span><br><span class="line">        <span class="comment">// verify something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
      <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="/images/wechat-qcode.png" alt="chenhang wechat" style="width: 200px; max-width: 100%;">
  <div></div>
</div>


    <footer class="post-footer">
          
        
        <div class="post-tags">
            <a href="/tags/单元测试/" rel="tag"># 单元测试</a>
          
            <a href="/tags/Robolectric/" rel="tag"># Robolectric</a>
          
        </div>
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/2016/12/01/design-patterns-template-and-strategy/" rel="next" title="设计模式之模板方法模式和策略模式">
                <i class="fa fa-chevron-left"></i> 设计模式之模板方法模式和策略模式
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
              <a href="/2016/12/18/dagger2/" rel="prev" title="依赖注入利器 - Dagger ‡">
                依赖注入利器 - Dagger ‡ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
    </footer>
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  


        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.png"
      alt="chenhang">
  <p class="site-author-name" itemprop="name">chenhang</p>
  <div class="site-description motion-element" itemprop="description">博观而约取，厚积而薄发。</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">58</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/shensky711" title="GitHub &rarr; https://github.com/shensky711" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://blog.csdn.net/shensky711" title="CSDN &rarr; https://blog.csdn.net/shensky711" rel="noopener" target="_blank"><i class="fa fa-fw fa-archive"></i>CSDN</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:shensky711@gmail.com" title="E-Mail &rarr; mailto:shensky711@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#如何使用？"><span class="nav-number">2.</span> <span class="nav-text">如何使用？</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#为项目添加依赖"><span class="nav-number">2.1.</span> <span class="nav-text">为项目添加依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定RobolectricTestRunner为运行器"><span class="nav-number">2.2.</span> <span class="nav-text">指定RobolectricTestRunner为运行器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Shadow类"><span class="nav-number">2.3.</span> <span class="nav-text">什么是Shadow类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Config配置"><span class="nav-number">2.4.</span> <span class="nav-text">@Config配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置SDK版本"><span class="nav-number">2.5.</span> <span class="nav-text">配置SDK版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Application类"><span class="nav-number">2.6.</span> <span class="nav-text">配置Application类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#指定Resource路径"><span class="nav-number">2.7.</span> <span class="nav-text">指定Resource路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用第三方Library-Resources"><span class="nav-number">2.8.</span> <span class="nav-text">使用第三方Library Resources</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用限定的资源文件"><span class="nav-number">2.9.</span> <span class="nav-text">使用限定的资源文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Properties文件"><span class="nav-number">2.10.</span> <span class="nav-text">Properties文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统属性配置"><span class="nav-number">2.11.</span> <span class="nav-text">系统属性配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#驱动Activity生命周期"><span class="nav-number">2.12.</span> <span class="nav-text">驱动Activity生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#追加模块"><span class="nav-number">2.13.</span> <span class="nav-text">追加模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义Shadow类"><span class="nav-number">2.14.</span> <span class="nav-text">自定义Shadow类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shadow类中访问原始类的field"><span class="nav-number">2.15.</span> <span class="nav-text">Shadow类中访问原始类的field</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何在测试用例中让Shadow生效"><span class="nav-number">2.16.</span> <span class="nav-text">如何在测试用例中让Shadow生效</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用测试场景"><span class="nav-number">3.</span> <span class="nav-text">常用测试场景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#页面跳转验证"><span class="nav-number">3.1.</span> <span class="nav-text">页面跳转验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UI组件状态验证"><span class="nav-number">3.2.</span> <span class="nav-text">UI组件状态验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证Dialog"><span class="nav-number">3.3.</span> <span class="nav-text">验证Dialog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证Toast"><span class="nav-number">3.4.</span> <span class="nav-text">验证Toast</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证Fragment"><span class="nav-number">3.5.</span> <span class="nav-text">验证Fragment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证BroadcastReceiver"><span class="nav-number">3.6.</span> <span class="nav-text">验证BroadcastReceiver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证Service"><span class="nav-number">3.7.</span> <span class="nav-text">验证Service</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenhang</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">259k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">3:55</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
    
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  <script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>

  
  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>



  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>



  <script src="/js/next-boot.js?v=7.3.0"></script>

  

  

  


  























  <script src="/js/local-search.js?v=7.3.0"></script>













    
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: true,
    appId: 'ST1hmgzJfF6c44BNUyK56qad-gzGzoHsz',
    appKey: 'Wy4dwHBHU556tTDardpzBI3i',
    placeholder: '说点什么吧~',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn'
  });
</script>


</body>
</html>
